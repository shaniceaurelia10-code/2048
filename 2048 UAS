from random import choice, randint

def init_board():
    return [[0]*4 for _ in range(4)]

def add_new_tile(board):
    empty = [(r,c) for r in range(4) for c in range(4) if board[r][c]==0]
    if empty:
        r,c = choice(empty)
        board[r][c] = 4 if randint(1,10)==1 else 2

def compress(row):
    nums = [x for x in row if x!=0]
    return nums + [0]*(4-len(nums))

def merge(row):
    for i in range(3):
        if row[i]!=0 and row[i]==row[i+1]:
            row[i]*=2
            row[i+1]=0
    return row

def reverse(row): return row[::-1]
def transpose(board): return [list(x) for x in zip(*board)]

def move_left(board):
    moved = False
    new = []
    for row in board:
        c = compress(row)
        m = merge(c)
        f = compress(m)
        new.append(f)
        if f != row: moved = True
    return new, moved

def move_right(board):
    rev = [reverse(r) for r in board]
    moved_board, moved = move_left(rev)
    return [reverse(r) for r in moved_board], moved

def move_up(board):
    t = transpose(board)
    moved_board, moved = move_left(t)
    return transpose(moved_board), moved

def move_down(board):
    t = transpose(board)
    moved_board, moved = move_right(t)
    return transpose(moved_board), moved

def can_move(board):
    if any(0 in row for row in board): return True
    for r in range(4):
        for c in range(3):
            if board[r][c]==board[r][c+1]: return True
    for c in range(4):
        for r in range(3):
            if board[r][c]==board[r+1][c]: return True
    return False

def draw(board, score):
    print("\nScore:", score)
    print("-"*24)
    for row in board:
        print(" ".join(f"{x}".rjust(4) if x!=0 else "   ." for x in row))
    print("-"*24)

board = init_board()
score = 0
add_new_tile(board); add_new_tile(board)

while True:
    draw(board, score)
    move = input("Move (W/A/S/D or Q to quit): ").lower()
    if move=="q": break
    moves = {"w": move_up, "a": move_left, "s": move_down, "d": move_right}
    if move not in moves: continue
    new_board, moved = moves[move](board)
    if moved:
        for r in range(4):
            for c in range(4):
                if new_board[r][c] > board[r][c]:
                    score += new_board[r][c]
        board = new_board
        add_new_tile(board)
    if not can_move(board):
        draw(board, score)
        print("GAME OVER!")
        break
